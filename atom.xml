<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>随想录</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://dhf.im/"/>
  <updated>2016-04-26T14:54:42.000Z</updated>
  <id>http://dhf.im/</id>
  
  <author>
    <name>dhf</name>
    <email>a@dhf.im</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>服务注册与服务发现</title>
    <link href="http://dhf.im/2016/04/26/service_registry_discovery/"/>
    <id>http://dhf.im/2016/04/26/service_registry_discovery/</id>
    <published>2016-04-26T11:54:28.000Z</published>
    <updated>2016-04-26T14:54:42.000Z</updated>
    
    <content type="html">&lt;p&gt;最近把公司所有的 RPC 服务都加上了服务注册及服务发现，多亏了各位同事的支持才能这么短时间就全部替换完毕并更新上线。  &lt;/p&gt;
&lt;p&gt;为什么做这件事情呢？公司里的业务服务都是微服务架构，每个 RPC 服务做的事情都很简单，随着业务的不断发展，RPC 服务也越来越多，目前已经有上百个 RPC 服务了。之前调用这些 RPC 服务的地方都是通过配置文件写死具体每个 RPC 服务所在的 ip 和端口，配置文件里充斥着各种服务的 ip 端口信息，想要动态扩容服务机器或者做故障转移也很不方便。而部署 RPC 服务的时候还得到 WIKI 页面上登记该服务所在的 ip 和占用的端口号，调用方也需要到这个页面来查找服务部署信息，对我这种懒人来说也是无法忍受的。为了解决这些问题，决定加上服务注册发现。&lt;/p&gt;
&lt;p&gt;服务注册发现有非常多的开源解决方案，作为一个懒人，有现成能用的当然就捡现成的用了。问题是这么多解决方案，怎么挑呢？当时候选列表有 servicex（公司同事作品）、 dubbo（阿里巴巴）、curator（Netflix）、consul（HashiCorp）、etcd（CoreOS），最终我选择了 consul。至于选择 consul 的原因，很简单：设计合理、使用方便、维护轻松、可用性高、符合我的审美 :D&lt;/p&gt;
&lt;p&gt;ServiceX: 公司同事个人作品，是他用了几天时间开发的，时间仓促设计不合理，而且公司人手紧缺后续也肯定没有时间精力继续维护，这个首先就被我排除在考虑范围了。&lt;/p&gt;
&lt;p&gt;dubbo: 阿里巴巴开源作品，Java API，服务需使用 API 自主注册。github 上该项目还挺多人关注，但注意到该项目最后发布时间是 2014年10月，距今已有一年半时间了，新版本似乎也无疾而终，这个也被我排除掉了。&lt;/p&gt;
&lt;p&gt;curator: Netflix 开源作品，目前归到 Apache 基金会下，使用 zookeeper 存储服务信息，Java API，服务需使用 API 自主注册，设计理念及使用方式不符合个人审美，淘汰。&lt;/p&gt;
&lt;p&gt;consul: HashiCorp 开源作品，提供 RESTful API 和 DNS API，设计思想和 DNS 非常类似(其实服务注册发现本质上就是 DNS SRV 记录)。服务通过 consul 配置文件注册，无需在现有程序中加任何代码，当然也可利用 RESTful API 进行自主注册。服务只需和本机的 consul 通讯即可完成服务注册及服务发现，本机的 consul agent 会自行与 consul server 通讯以发现其他机器上注册的服务，consul 与 consul 之间通过 gossip 协议自动组成集群。&lt;/p&gt;
&lt;p&gt;etcd: CoreOS 提供的 key/value 存储服务，可用于服务注册发现，未详细了解。&lt;/p&gt;
&lt;p&gt;总的来说，consul 的设计比较合理，专注做一件事情并把这件事情做好了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近把公司所有的 RPC 服务都加上了服务注册及服务发现，多亏了各位同事的支持才能这么短时间就全部替换完毕并更新上线。  &lt;/p&gt;
&lt;p&gt;为什么做这件事情呢？公司里的业务服务都是微服务架构，每个 RPC 服务做的事情都很简单，随着业务的不断发展，RPC 服务也越来越多，目前
    
    </summary>
    
    
      <category term="服务注册" scheme="http://dhf.im/tags/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C/"/>
    
      <category term="服务发现" scheme="http://dhf.im/tags/%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0/"/>
    
      <category term="consul" scheme="http://dhf.im/tags/consul/"/>
    
      <category term="dubbo" scheme="http://dhf.im/tags/dubbo/"/>
    
  </entry>
  
  <entry>
    <title>Nginx配置使用过期缓存</title>
    <link href="http://dhf.im/2014/04/15/nginx-use-stale-cache/"/>
    <id>http://dhf.im/2014/04/15/nginx-use-stale-cache/</id>
    <published>2014-04-14T17:28:46.000Z</published>
    <updated>2016-04-26T14:51:40.000Z</updated>
    
    <content type="html">&lt;p&gt;今天下午一朋友在群里问起  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nginx有什么module可以达到这个效果：
1. 对指定uri做缓存，可配置有效时间
2. 失效时会继续返回当前缓存的页面，但会起个线程去读新的内容；并更新已缓存内容
3. 当2发生时，如果请求到的内容非200返回码，不更新缓存，继续等一个超时再去取
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;另一朋友提议说还是自己写一个吧，第三条需求应该没有能满足的。但一看这问题，全都是很通用的使用场景啊，nginx肯定有现成的模块了吧。翻查了下 &lt;a href=&quot;http://nginx.org/cn/docs/http/ngx_http_proxy_module.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ngx_http_proxy_module&lt;/a&gt; 的文档，找到  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;语法: proxy_cache_use_stale error | timeout | invalid_header | updating | http_500 | http_502 | http_503 | http_504 | http_404 | off ...;  
默认值: proxy_cache_use_stale off;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;看这描述完全符合这朋友的需求嘛，为何他却没发现呢？打探了一下才发现，原来他们误以为&lt;code&gt;proxy_cache_use_stale&lt;/code&gt;只能设置一个值，文档上多个值之间是用‘|’隔开的，而且该指令的默认值是说明上只显示了一个&lt;code&gt;off&lt;/code&gt;，让他们误解成这指令只能设置一个值了。  &lt;/p&gt;
&lt;p&gt;其实该指令说明上还有一句，&lt;code&gt;这条指令的参数与proxy_next_upstream指令的参数相同&lt;/code&gt;，如果认真去查看指令&lt;code&gt;proxy_next_upstream&lt;/code&gt;的说明也应该能发现是支持多个值的。不过这文档确实也还可以写得更清晰详细一些，避免粗心的人误解。  &lt;/p&gt;
&lt;p&gt;另外就是，千万不要总想着自己遇到的问题是特殊的，自己能遇到的问题绝大多数情况下都已经有前人解决过了，多查文档多用搜索，绝对比自己又重新发明一次轮子省时省事而且安全可靠多了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天下午一朋友在群里问起  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nginx有什么module可以达到这个效果：
1. 对指定uri做缓存，可配置有效时间
2. 失效时会继续返回当前缓存的页面，但会起个线程去读新的内容；并更新已缓存内容
3. 当2发生时，如果请求到的内容非200
    
    </summary>
    
    
      <category term="nginx" scheme="http://dhf.im/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>搭建Redis存储集群</title>
    <link href="http://dhf.im/2014/03/28/redis-storage-cluster/"/>
    <id>http://dhf.im/2014/03/28/redis-storage-cluster/</id>
    <published>2014-03-28T15:18:55.000Z</published>
    <updated>2016-04-26T14:53:19.000Z</updated>
    
    <content type="html">&lt;p&gt;以前都是将redis当做纯粹的cache server使用，关掉snapshot和aof，也不需要slave。其中任何一台挂掉也无所谓，反正可以从db中再加载回来。  &lt;/p&gt;
&lt;p&gt;有个项目DBA抱怨了很久，每天频繁往db插入太多数据，而这些数据90%以上都是只需要存储几天就过期，哪怕丢失部分数据也是可以接受的。综合这些条件，这些会过期的数据用redis来做临时存储应该是比较适合的。打开redis的aof，能够尽量保证数据持久存储下来。安全起见，给master配2个slave，再起3个 &lt;a href=&quot;http://redis.io/topics/sentinel&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;sentinel&lt;/a&gt; 做服务监控和故障转移，这样发生故障也尽量不需要人工介入。  &lt;/p&gt;
&lt;p&gt;需要注意的是，redis是单进程的，而且slave初次和master同步时，会强制master做一次snapshot。为了充分利用机器cpu资源并减少snapshot的开销，应该在一台机器上起多个redis实例，每个redis实例占用内存不应太大。为了充分利用内存，修改 &lt;code&gt;/etc/sysctl.conf&lt;/code&gt;，增加配置项 &lt;a href=&quot;http://redis.io/topics/faq&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;code&gt;vm.overcommit_memory=1&lt;/code&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;redis 2.8之前，replication不支持 &lt;a href=&quot;http://redis.io/topics/replication&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Partial resynchronization&lt;/a&gt;，网络瞬断会导致强制重新同步，造成不必要的开销，影响服务稳定性。故请务必使用redis 2.8以上版本。  &lt;/p&gt;
&lt;p&gt;需要注意的是，sentinel严重依赖系统时间，一旦系统时间被非预期的方式修改，或者系统非常繁忙，又或者进程因为某些原因而被阻塞时，sentinel可能会工作不正常。sentinel检测到系统不正常后，将切换到 &lt;a href=&quot;http://redis.io/topics/sentinel&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;TILT&lt;/a&gt; 模式，只监控而不做其他操作（故障转移等）。&lt;/p&gt;
&lt;p&gt;Master参考配置:  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# ${port} 表示实际的端口号
# 复制N份redis.conf到/etc/redis/redis_${port}.conf
# 注意：不能共用同一份配置文件，会被redis sentinel重写
# 需要修改的配置如下（除提到的修改项外其余保持默认配置不变）：

port ${port}

# /var/run/redis/${port}/ 目录必须已经存在
dir /var/run/redis/${port}/

pidfile redis.pid
logfile redis.log

# 开启aof文件记录，启动后再手工关闭aof
appendonly yes
appendfilename redis.aof

# 虽然关掉了snapshot，但是slave初次同步时会强制master snapshot
# 请留够内存用于fork snapshot，建议留40%机器内存
# 避免多个slave同时SYNC
dbfilename redis.rdb

# 关闭rdb snapshot
# save 900 1
# save 300 10
# save 60 10000

# 后台运行
daemonize yes

# 每个redis 4gb
maxmemory 4294967296
maxmemory-policy volatile-ttl
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Master启动命令:  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;./redis-server /etc/redis/redis_${port}.conf
# 若是故障后重启，不需要关闭aof，而是在同步完成后关闭新master的aof
./redis-cli -p ${port} config set appendonly no
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Slave参考配置:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# 略，基本同Master配置，只在最后加多一行
slaveof $master_ip $master_port  
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Slave启动命令:  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;./redis-server /etc/redis/redis_${port}.conf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Sentinel参考配置:  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# ${port} 表示实际的端口号
port ${port}
# /var/run/redis/${port}/ 目录必须已经存在
dir /var/run/redis/${port}/

pidfile redis.pid
logfile redis.log

# 后台运行
daemonize yes

#start config for ${master1_name}
sentinel monitor ${master1_name} ${master1_ip} ${master1_port} 2
sentinel down-after-milliseconds ${master1_name} 5000
sentinel failover-timeout ${master1_name} 900000
sentinel parallel-syncs ${master1_name} 1

# 触发报警脚本，${monitor1_path}是报警脚本的路径
# 调用脚本时传递两个参数：${event_type}, ${event_description}
#sentinel notification-script ${master1_name} ${monitor1_path}
#end config for ${master1_name}

# 剩余master的配置参考master1的配置项进行补充
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Sentinel启动命令:  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;./redis-server /etc/redis/sentinel_${port}.conf --sentinel
&lt;/code&gt;&lt;/pre&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;以前都是将redis当做纯粹的cache server使用，关掉snapshot和aof，也不需要slave。其中任何一台挂掉也无所谓，反正可以从db中再加载回来。  &lt;/p&gt;
&lt;p&gt;有个项目DBA抱怨了很久，每天频繁往db插入太多数据，而这些数据90%以上都是只需要存储几
    
    </summary>
    
    
      <category term="redis" scheme="http://dhf.im/tags/redis/"/>
    
      <category term="cluster" scheme="http://dhf.im/tags/cluster/"/>
    
  </entry>
  
  <entry>
    <title>在Ivy中引用Maven管理依赖的lib</title>
    <link href="http://dhf.im/2014/03/27/ivy-dependents-on-maven-repo/"/>
    <id>http://dhf.im/2014/03/27/ivy-dependents-on-maven-repo/</id>
    <published>2014-03-27T12:20:37.000Z</published>
    <updated>2016-04-26T14:47:22.000Z</updated>
    
    <content type="html">&lt;p&gt;若只需要该lib本身而不引入该lib的任何依赖, 在dependency的属性中设置  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;transitive=&amp;quot;false&amp;quot;  
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;若需要该lib和该lib所必须的依赖关系而不引入optional的依赖, 在dependency的属性中设置  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;conf=&amp;quot;${yourconf}-&amp;gt;default&amp;quot;  
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Maven中的scope都被Ivy转换成对应的conf，可以对应着修改设置。  &lt;/p&gt;
&lt;p&gt;参考资料:&lt;br&gt;&lt;a href=&quot;https://ant.apache.org/ivy/history/latest-milestone/ivyfile/dependency.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://ant.apache.org/ivy/history/latest-milestone/ivyfile/dependency.html&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://www.symphonious.net/2010/01/25/using-ivy-for-dependency-management/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://www.symphonious.net/2010/01/25/using-ivy-for-dependency-management/&lt;/a&gt;  &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;若只需要该lib本身而不引入该lib的任何依赖, 在dependency的属性中设置  &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;transitive=&amp;quot;false&amp;quot;  
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;若需要该lib和该lib所必须的依赖关系而不引入option
    
    </summary>
    
    
      <category term="ivy" scheme="http://dhf.im/tags/ivy/"/>
    
      <category term="maven" scheme="http://dhf.im/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>Mou总在最前窗口</title>
    <link href="http://dhf.im/2014/03/21/mou-always-front/"/>
    <id>http://dhf.im/2014/03/21/mou-always-front/</id>
    <published>2014-03-21T15:53:43.000Z</published>
    <updated>2016-04-26T14:50:34.000Z</updated>
    
    <content type="html">&lt;p&gt;最近发现打开Mou后一直占据着最前窗口，点击其他程序都无法切换窗口，而将Mou最小化后就再也无法切换回Mou了。  &lt;/p&gt;
&lt;p&gt;为这个问题烦恼几天后终于受不了，Google “Mou 总在最前”后找到&lt;a href=&quot;http://www.v2ex.com/t/97996&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;V2EX&lt;/a&gt;上的一篇文章，看症状与我的几乎一模一样。遂试之，症状消失，感谢楼主！  &lt;/p&gt;
&lt;p&gt;解决方法如下:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;View-&amp;gt;Toggle Floating
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;看来是不小心在用Mou编辑文档时，按下了其他程序的快捷键 - -#&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近发现打开Mou后一直占据着最前窗口，点击其他程序都无法切换窗口，而将Mou最小化后就再也无法切换回Mou了。  &lt;/p&gt;
&lt;p&gt;为这个问题烦恼几天后终于受不了，Google “Mou 总在最前”后找到&lt;a href=&quot;http://www.v2ex.com/t/9799
    
    </summary>
    
    
      <category term="mou" scheme="http://dhf.im/tags/mou/"/>
    
  </entry>
  
  <entry>
    <title>Java RPC工具eurpc 0.2.0更新日志</title>
    <link href="http://dhf.im/2012/12/22/java-eurpc/"/>
    <id>http://dhf.im/2012/12/22/java-eurpc/</id>
    <published>2012-12-22T12:24:21.000Z</published>
    <updated>2016-04-26T14:48:05.000Z</updated>
    
    <content type="html">&lt;ol&gt;
&lt;li&gt;将I/O逻辑从RpcClient中抽取出来到RpcConnection中，得益于此，使得同一个client多次方法调用间可以使用不同的connection（连接池实现起来就更自然了）&lt;/li&gt;
&lt;li&gt;一些类名称做了修改，含义更清晰。SimpleSerializer重命名为JDKObjectSerializer，SimpleRpcServer重命名为BIORpcServer&lt;/li&gt;
&lt;li&gt;JDKObjectSerializer的网络传输方式也增加了length field header，终于和其他Serializer的格式一致（NettyRpcServer/NettyRpcConnection也可以使用JDKObjectSerializer了）&lt;/li&gt;
&lt;li&gt;增加了Logger接口定义以及一些常用日志组件的LoggerAdapter，并且提供了日志组件自动检测机制（LoggerHolder类，检测顺序：slf4j–&amp;gt;commons-logging–&amp;gt;log4j–&amp;gt;java.util.Logger）&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;ol&gt;
&lt;li&gt;将I/O逻辑从RpcClient中抽取出来到RpcConnection中，得益于此，使得同一个client多次方法调用间可以使用不同的connection（连接池实现起来就更自然了）&lt;/li&gt;
&lt;li&gt;一些类名称做了修改，含义更清晰。SimpleSerializ
    
    </summary>
    
    
      <category term="eurpc" scheme="http://dhf.im/tags/eurpc/"/>
    
      <category term="java" scheme="http://dhf.im/tags/java/"/>
    
      <category term="rpc" scheme="http://dhf.im/tags/rpc/"/>
    
  </entry>
  
  <entry>
    <title>JS条件编译</title>
    <link href="http://dhf.im/2012/05/05/js_conditional_compilation/"/>
    <id>http://dhf.im/2012/05/05/js_conditional_compilation/</id>
    <published>2012-05-05T10:08:33.000Z</published>
    <updated>2016-04-26T14:49:59.000Z</updated>
    
    <content type="html">&lt;p&gt;最近给公司开发新邮件提醒的浏览器扩展时，需要分别开发搜狗和Chrome版本，而这两个版本绝大部分代码都是相同的，只有少数代码的区别。如果因为这么几行代码的不同而需要分拆到多个js文件中就会存在重复代码，后续有修改时就需要修改多处，维护起来不太方便。&lt;/p&gt;
&lt;p&gt;在C语言里，可以根据不同的平台编译出不同的二进制代码，那么是否也可以对JS做这样的处理呢？答案是肯定的，google后发现有两个项目可以处理这个事情，一个是&lt;a href=&quot;http://code.google.com/p/js-build-tools/&quot; title=&quot;js_build_tools&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;js_build_tools&lt;/a&gt;，另一个是&lt;a href=&quot;https://github.com/bramstein/js-preprocess&quot; title=&quot;js-preprocess&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;js-prepross&lt;/a&gt;。试用js_build_tools时发现这个东西只能对单个文件进行处理，不支持fileset，且输入文件不能和输出文件同名，使用起来不太方便。而js-preprocess支持fileset，输入文件可以和输出文件同名。相比js_build_tools，js-preprocess使用较为方便，但也存在一些不足。js-preprocess只支持相对于项目的相对路径，ant的taskname只能命名为preprocess。js_build_tools里的编译指令相比C的编译指令多了注释符号//，对js IDE相对友好。&lt;/p&gt;
&lt;p&gt;花了一点时间对js-preprocess做了一些修改，fork的项目地址-&amp;gt;&lt;a href=&quot;https://github.com/hfdiao/js-preprocess&quot; title=&quot;传送门&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;传送门&lt;/a&gt;。fork后支持绝对路径，ant的taskname没有限制，编译指令也改成js_build_tools的方式。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近给公司开发新邮件提醒的浏览器扩展时，需要分别开发搜狗和Chrome版本，而这两个版本绝大部分代码都是相同的，只有少数代码的区别。如果因为这么几行代码的不同而需要分拆到多个js文件中就会存在重复代码，后续有修改时就需要修改多处，维护起来不太方便。&lt;/p&gt;
&lt;p&gt;在C语言里
    
    </summary>
    
    
      <category term="javascript" scheme="http://dhf.im/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>setSoTimeout does not work with nio SocketChannel</title>
    <link href="http://dhf.im/2011/12/20/setsotimeout-does-not-work-with-nio-socketchannel/"/>
    <id>http://dhf.im/2011/12/20/setsotimeout-does-not-work-with-nio-socketchannel/</id>
    <published>2011-12-20T09:39:07.000Z</published>
    <updated>2016-04-26T14:55:09.000Z</updated>
    
    <content type="html">&lt;p&gt;通过SocketChannel.socket().setSoTimeout(timeout)设置读超时，对于SocketChannel.read(buffer)操作来说是不会有任何效果的，如果SocketChannel设置了blocking mode的话会一致阻塞直到有可读取的内容或EOF。  &lt;/p&gt;
&lt;p&gt;有人就此给Sun提了个bug（&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4614802），&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4614802），&lt;/a&gt; 但Sun不认为这是个bug：  &lt;/p&gt;
&lt;pre&gt;
Not a bug.  The read methods in SocketChannel (and DatagramChannel) do not
support timeouts.  If you need the timeout functionality then use the read
methods of the associated Socket (or DatagramSocket) object.
&lt;/pre&gt;

&lt;p&gt;既然Sun不认为这是个bug只能自己使用的时候注意了（有人说起码是个Javadoc的bug， absolutely！）  &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;通过SocketChannel.socket().setSoTimeout(timeout)设置读超时，对于SocketChannel.read(buffer)操作来说是不会有任何效果的，如果SocketChannel设置了blocking mode的话会一致阻塞直到有可读
    
    </summary>
    
    
      <category term="java" scheme="http://dhf.im/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>网易新邮件提醒Chrome扩展开发</title>
    <link href="http://dhf.im/2011/11/20/nmpush-chrome/"/>
    <id>http://dhf.im/2011/11/20/nmpush-chrome/</id>
    <published>2011-11-19T17:26:19.000Z</published>
    <updated>2016-04-26T14:52:12.000Z</updated>
    
    <content type="html">&lt;p&gt;最近突然对chrome扩展开发来了兴趣，刚好最近了解了下网易邮箱助手获取新邮件到达的方法就想着自己动手写一个新邮件到达提醒的chrome扩展（其实挺蛋疼的，网易邮箱网页版本身就提供了提醒功能）。协议可以通过抓包来了解，也比较简单易懂。&lt;/p&gt;
&lt;p&gt;周六睡醒就花了几个小时一边看chrome扩展的&lt;a href=&quot;http://open.chrome.360.cn/html/dev_manifest.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;开发文档&lt;/a&gt;一边码代码，花了几个小时就把第一版弄出来了，chrome的扩展开发还是挺方便的。&lt;/p&gt;
&lt;p&gt;一般来说，extensions都会有一个背景页面（background_page）用于主流程处理，逻辑代码通常都在这里。除了流程处理外一般还会有extension的设置需要处理，那么一般也会提供一个选项页面（options_page）。extension各个页面之间可以通过chrome.extension的api来进行通讯，比如可以通过chrome.extension.getBackgroudPage()获得背景页面的DOM树。API都相对比较简单，用的时候翻翻手册就很容易明白了（PS：360翻译的质量真不敢恭维）。&lt;/p&gt;
&lt;p&gt;项目代码托管在google code上，有兴趣的可以自行&lt;a href=&quot;http://code.google.com/p/nmpush/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;查看&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;TODO：&lt;br&gt;&lt;del&gt; 1. 目前版本账号密码都是明文保存的，可以改成md5处理。&lt;/del&gt;&lt;br&gt;&lt;del&gt; 2. 点击进入邮箱查看邮件。&lt;/del&gt;&lt;br&gt;&lt;del&gt; 3. 5秒后自动关闭弹窗。&lt;/del&gt;&lt;br&gt;&lt;del&gt; 4. 自动更新。&lt;/del&gt;&lt;br&gt;5. 多账号支持。&lt;br&gt;6. 异常情况处理。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近突然对chrome扩展开发来了兴趣，刚好最近了解了下网易邮箱助手获取新邮件到达的方法就想着自己动手写一个新邮件到达提醒的chrome扩展（其实挺蛋疼的，网易邮箱网页版本身就提供了提醒功能）。协议可以通过抓包来了解，也比较简单易懂。&lt;/p&gt;
&lt;p&gt;周六睡醒就花了几个小时一
    
    </summary>
    
    
      <category term="chrome" scheme="http://dhf.im/tags/chrome/"/>
    
      <category term="pushmail" scheme="http://dhf.im/tags/pushmail/"/>
    
  </entry>
  
  <entry>
    <title>[RT] Using stunnel to telnet into GMail IMAP</title>
    <link href="http://dhf.im/2011/10/17/using-stunnel-to-telnet-into-gmail-imap/"/>
    <id>http://dhf.im/2011/10/17/using-stunnel-to-telnet-into-gmail-imap/</id>
    <published>2011-10-17T13:58:03.000Z</published>
    <updated>2016-04-26T14:36:20.000Z</updated>
    
    <content type="html">&lt;p&gt;PS: &lt;a href=&quot;http://wiredbytes.com/node/8&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文&lt;/a&gt;被墙， 转来方便墙内翻阅。 最近在搞IMAP相关的东西， 一直头疼不知道怎么命令行下测gmail的一些行为， 这篇文章真是帮大忙了。  &lt;/p&gt;
&lt;pre&gt;
By edwin - Posted on 12 February 2009

Here is a case study of how stunnel can be used to test an SSL based protocol. We will create an stunnel configuration that reroutes the IMAP port (TCP 143) to the Secure IMAP port (TCP 993) on GMail&#39;s IMAP server (imap.gmail.com). We will than test the setup by using telnet.

I will be using Ubuntu 8.10 (Intrepid Ibex).

First, let&#39;s install stunnel.

sudo apt-get install stunnel

Edit /etc/default/stunnel4, change ENABLED=0 to ENABLED=1

Edit /etc/stunnel/stunnel.conf as shown in the example below:

; Sample stunnel configuration file by Michal Trojnara 2002-2006
; Some options used here may not be adequate for your particular configuration
; Please make sure you understand them (especially the effect of chroot jail)

; Certificate/key is needed in server mode and optional in client mode
;cert = /etc/stunnel/mail.pem
;key = /etc/stunnel/mail.pem

; Protocol version (all, SSLv2, SSLv3, TLSv1)
sslVersion = SSLv3

; Some security enhancements for UNIX systems - comment them out on Win32
chroot = /var/lib/stunnel4/
setuid = stunnel4
setgid = stunnel4
; PID is created inside chroot jail
pid = /stunnel4.pid

; Some performance tunings
socket = l:TCP_NODELAY=1
socket = r:TCP_NODELAY=1
;compression = rle

; Workaround for Eudora bug
;options = DONT_INSERT_EMPTY_FRAGMENTS

; Authentication stuff
;verify = 2
; Don&#39;t forget to c_rehash CApath
; CApath is located inside chroot jail
;CApath = /certs
; It&#39;s often easier to use CAfile
;CAfile = /etc/stunnel/certs.pem
; Don&#39;t forget to c_rehash CRLpath
; CRLpath is located inside chroot jail
;CRLpath = /crls
; Alternatively you can use CRLfile
;CRLfile = /etc/stunnel/crls.pem

; Some debugging stuff useful for troubleshooting
debug = 7
output = /var/log/stunnel4/stunnel.log

; Use it for client mode
client = yes

; Service-level configuration

;[pop3s]
;accept = 995
;connect = 110

[imaps]
accept = 143
connect = imap.gmail.com:993

;[ssmtp]
;accept = 465
;connect = 25

;[https]
;accept = 443
;connect = 80
;TIMEOUTclose = 0

; vim:ft=dosini

Start up Stunnel

sudo /etc/init.d/stunnel4 start

Verify that the IMAP is listening on the local server.

netstat -an | grep -iw LISTEN
tcp 0 0 0.0.0.0:143 0.0.0.0:* LISTEN

The following requires that your GMail account have IMAP enabled. This is not enabled by default. Replace username@gmail.com with your real email address. Replace password with your real password.

telnet localhost 143
Trying 127.0.0.1...
Connected to localhost.
Escape character is &#39;^]&#39;.
* OK Gimap ready for requests from 71.65.199.7 c5if2789008nfi.67
)
01 LOGIN username@gmail.com password
01 OK username@gmail.com authenticated (Success)
02 LOGOUT
* BYE LOGOUT Requested
02 OK 73 good day (Success)
Connection closed by foreign host.

That&#39;s it. If you&#39;re feeling adventourous you can use Hydra to brute force an account you own.

./hydra -l yourfriend@gmail.com -P password.txt -V localhost imap
&lt;/pre&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;PS: &lt;a href=&quot;http://wiredbytes.com/node/8&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文&lt;/a&gt;被墙， 转来方便墙内翻阅。 最近在搞IMAP相关的东西， 一直头疼不知道怎么命令行下测gmail的一些行为， 这篇
    
    </summary>
    
    
      <category term="ssl" scheme="http://dhf.im/tags/ssl/"/>
    
      <category term="stunnel" scheme="http://dhf.im/tags/stunnel/"/>
    
      <category term="telnet" scheme="http://dhf.im/tags/telnet/"/>
    
      <category term="imap" scheme="http://dhf.im/tags/imap/"/>
    
  </entry>
  
  <entry>
    <title>如何抓包iPad的 http/https 请求</title>
    <link href="http://dhf.im/2011/05/15/ipad_http_sniffer/"/>
    <id>http://dhf.im/2011/05/15/ipad_http_sniffer/</id>
    <published>2011-05-14T21:13:47.000Z</published>
    <updated>2016-04-26T14:46:48.000Z</updated>
    
    <content type="html">&lt;p&gt;ipad上目前没发现有抓包的工具， 就算有也应该不会好用到哪里去， 但要对ipad的http或https请求进行抓包该怎么办呢？方法还是有的， 前提是有两块能上网的网卡（至少有一块无线网卡，主要是当无线路由用，本身有无线路由的就忽略connectify这一步吧）以及一个Windows操作系统（都怪Fiddler2只有windows版本）。  &lt;/p&gt;
&lt;p&gt;首先， 通过Ad-hoc open（Access Point等其他方式也可以， 我懒得输密码就设成Ad-hoc open了）将无线网卡共享出去（可以通过&lt;a href=&quot;http://www.connectify.me/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Connectify&lt;/a&gt;傻瓜化地设置， 不过dhcp似乎经常出问题啊）  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;!--￼0--&amp;gt;/images/1a58992e494361019203c5b922f11f41955fd9ed.png&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;然后， 开启&lt;a href=&quot;http://www.fiddler2.com/fiddler2/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Fiddler2&lt;/a&gt; （一个强大的http抓包工具）， 如果需要抓取https的话需要在Tools-&amp;gt;Fiddler Options-&amp;gt;HTTPS里勾选上Decrypt https traffic  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;!--￼1--&amp;gt;/images/67db5ae9703a0251529fbb5a4ebb8513256135ca.png&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;接着需要设置Fiddler2的代理服务，如果不希望抓取非ipad的http请求请不要勾选WinINET Connections的相关选项  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;!--￼2--&amp;gt;/images/9f8dc44a87b5d511dea71cd72adfac7627b289fe.png&quot; alt=&quot;&quot;&gt;  &lt;/p&gt;
&lt;p&gt;最后就是设置ipad的wifi了， wifi通过刚刚共享的无线进行上网并将HTTP代理设置为手动， 服务器地址填上192.168.2.1，端口填上8888（就是Fiddler2-&amp;gt;Tools-&amp;gt;Fiddler Options中填写的Fiddler listens on port），这样ipad上的所有http/https请求都能在Fiddler2上看到了。  &lt;/p&gt;
&lt;p&gt;PS： Fiddler2抓https请求是通过伪造证书来实现的，需要信任这个伪造的证书。  &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;ipad上目前没发现有抓包的工具， 就算有也应该不会好用到哪里去， 但要对ipad的http或https请求进行抓包该怎么办呢？方法还是有的， 前提是有两块能上网的网卡（至少有一块无线网卡，主要是当无线路由用，本身有无线路由的就忽略connectify这一步吧）以及一个Wi
    
    </summary>
    
    
      <category term="http" scheme="http://dhf.im/tags/http/"/>
    
      <category term="sniffer" scheme="http://dhf.im/tags/sniffer/"/>
    
      <category term="ipad" scheme="http://dhf.im/tags/ipad/"/>
    
  </entry>
  
  <entry>
    <title>如何修改deb安装包里的依赖关系/冲突</title>
    <link href="http://dhf.im/2011/03/12/deb_dependence_modify/"/>
    <id>http://dhf.im/2011/03/12/deb_dependence_modify/</id>
    <published>2011-03-12T12:15:18.000Z</published>
    <updated>2016-04-26T14:45:24.000Z</updated>
    
    <content type="html">&lt;p&gt;今天装code::blocks时， 总是提示  &lt;/p&gt;
&lt;pre&gt;
错误： 破坏已有软件包 &#39;codeblocks-common&#39; 对 codeblocks (&lt; 10.05-1) 的冲突关系
&lt;/pre&gt;

&lt;p&gt;直接打开deb包修改里面的control文件也没用，关闭后又恢复原样了。在 &lt;a href=&quot;http://ubuntuforums.org/showthread.php?t=636724&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ubuntuforms&lt;/a&gt; 搜到一段shell脚本倒是可以修改control文件后重新生成一个deb包， 脚本如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#!/bin/bash

if [[ -z &amp;quot;$1&amp;quot; ]]; then
    echo &amp;quot;Syntax: $0 debfile&amp;quot;
    exit 1
fi
DEBFILE=&amp;quot;$1&amp;quot;
TMPDIR=mktemp -d /tmp/deb.XXXXXXXXXX || exit 1
OUTPUT=basename &amp;quot;$DEBFILE&amp;quot; .deb.modfied.deb
if [[ -e &amp;quot;$OUTPUT&amp;quot; ]]; then
    echo &amp;quot;$OUTPUT exists.&amp;quot;
    rm -r &amp;quot;$TMPDIR&amp;quot;
    exit 1
fi
dpkg-deb -x &amp;quot;$DEBFILE&amp;quot; &amp;quot;$TMPDIR&amp;quot;
dpkg-deb --control &amp;quot;$DEBFILE&amp;quot; &amp;quot;$TMPDIR&amp;quot;/DEBIAN
if [[ ! -e &amp;quot;$TMPDIR&amp;quot;/DEBIAN/control ]]; then
    echo DEBIAN/control not found.
    rm -r &amp;quot;$TMPDIR&amp;quot;
    exit 1
fi
CONTROL=&amp;quot;$TMPDIR&amp;quot;/DEBIAN/control
MOD=stat -c &amp;quot;%y&amp;quot; &amp;quot;$CONTROL&amp;quot;
vi &amp;quot;$CONTROL&amp;quot;
if [[ &amp;quot;$MOD&amp;quot; == stat -c &amp;quot;%y&amp;quot; &amp;quot;$CONTROL&amp;quot; ]]; then
    echo Not modfied.
else
    echo Building new deb...
    dpkg -b &amp;quot;$TMPDIR&amp;quot; &amp;quot;$OUTPUT&amp;quot;
fi
rm -r &amp;quot;$TMPDIR&amp;quot;
&lt;/code&gt;&lt;/pre&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;今天装code::blocks时， 总是提示  &lt;/p&gt;
&lt;pre&gt;
错误： 破坏已有软件包 &#39;codeblocks-common&#39; 对 codeblocks (&lt; 10.05-1) 的冲突关系
&lt;/pre&gt;

&lt;p&gt;直接打开deb包修改里面的control文件也没用，关闭
    
    </summary>
    
    
      <category term="deb" scheme="http://dhf.im/tags/deb/"/>
    
      <category term="dependency" scheme="http://dhf.im/tags/dependency/"/>
    
      <category term="linux" scheme="http://dhf.im/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu下安装TP Link TL-WN821N 无线网卡驱动</title>
    <link href="http://dhf.im/2011/01/19/ubuntu_tp-link_tl-wn821n/"/>
    <id>http://dhf.im/2011/01/19/ubuntu_tp-link_tl-wn821n/</id>
    <published>2011-01-19T06:05:07.000Z</published>
    <updated>2016-04-26T14:39:21.000Z</updated>
    
    <content type="html">&lt;p&gt;前几天笔记本自带的无线网卡似乎坏了，系统没有识别这个设备，就买了TP Link的USB无线网卡TL-WN821N。插上后发现Ubuntu根本没有识别这个设备，还是无法上网。  &lt;/p&gt;
&lt;p&gt;郁闷之下，切回windows（TP Link随机光盘带有windows的驱动），上网搜索后发现有&lt;a href=&quot;http://madwifi-project.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;madwifi&lt;/a&gt;这个开源项目，但是该项目目前还不支持usb接口的网卡（其他两个版本ath5k/ath9k的设备支持列表也没找到TL-WN821N）。后来发现有人提到用ndiswrapper可以安装windows下的驱动文件，并且用IOGEAR GWU623.zip里面的驱动文件可以正常安装使用。但我这台机安装ndiswrapper后再装上GWU623的驱动，却还是无法上网！删掉这个驱动后用TL-WN821N自带光盘里的驱动文件，能正常上网了，oh yeah&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;前几天笔记本自带的无线网卡似乎坏了，系统没有识别这个设备，就买了TP Link的USB无线网卡TL-WN821N。插上后发现Ubuntu根本没有识别这个设备，还是无法上网。  &lt;/p&gt;
&lt;p&gt;郁闷之下，切回windows（TP Link随机光盘带有windows的驱动），上
    
    </summary>
    
    
      <category term="tl-wn821n" scheme="http://dhf.im/tags/tl-wn821n/"/>
    
      <category term="ubuntu" scheme="http://dhf.im/tags/ubuntu/"/>
    
      <category term="无线网卡" scheme="http://dhf.im/tags/%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1/"/>
    
  </entry>
  
  <entry>
    <title>桌游马尼拉规则调整乱想</title>
    <link href="http://dhf.im/2010/08/26/boardgame_manila_rule_extension/"/>
    <id>http://dhf.im/2010/08/26/boardgame_manila_rule_extension/</id>
    <published>2010-08-26T15:19:17.000Z</published>
    <updated>2016-04-26T14:42:45.000Z</updated>
    
    <content type="html">&lt;p&gt;今天跟着同事试着学了一把马尼拉，游戏还不错，不过5个人玩时间倒是长了些，花了快2个小时。&lt;/p&gt;
&lt;p&gt;前3回合凭着做海贼的天赋，暴发了一把，后面主要就是靠股票和上船运货稳扎稳打了，最后居然大胜。&lt;/p&gt;
&lt;p&gt;今天这局买港口话事权的价格普遍偏高，有一局我居然花了31块大洋买话事权，大家都太冲动了些，都是冲着股票去的。这里的股票只有升值（或者保值），如果改成和现实一样，既有可能涨也有可能跌的话游戏会不会更刺激呢？而且再加上一支海盗的股票，可选择的就更多了。刚开局的时候所有股票价格都为30，货物运送成功1次则股票价格涨1格，最多连涨3格（3次后就算继续运送成功也不涨）；货物运送失败1次则股票价格跌1格，同样，最多连跌3格；而海盗每成功劫1条船股票价格涨1格，1回合内没有劫到船则股票价格跌1格，连涨连跌次数同样是3格。这样调整之后，投资股票时则需要更谨慎，购买话事权的时候也或许会更冷静一些。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天跟着同事试着学了一把马尼拉，游戏还不错，不过5个人玩时间倒是长了些，花了快2个小时。&lt;/p&gt;
&lt;p&gt;前3回合凭着做海贼的天赋，暴发了一把，后面主要就是靠股票和上船运货稳扎稳打了，最后居然大胜。&lt;/p&gt;
&lt;p&gt;今天这局买港口话事权的价格普遍偏高，有一局我居然花了31块大洋
    
    </summary>
    
    
      <category term="桌游" scheme="http://dhf.im/tags/%E6%A1%8C%E6%B8%B8/"/>
    
      <category term="马尼拉" scheme="http://dhf.im/tags/%E9%A9%AC%E5%B0%BC%E6%8B%89/"/>
    
  </entry>
  
  <entry>
    <title>mysql字符默认不区分大小写？</title>
    <link href="http://dhf.im/2010/08/19/mysql_case_insensitive/"/>
    <id>http://dhf.im/2010/08/19/mysql_case_insensitive/</id>
    <published>2010-08-19T03:53:25.000Z</published>
    <updated>2016-04-26T14:51:08.000Z</updated>
    
    <content type="html">&lt;p&gt;最近发现短链接服务在生成短链接时经常会发生碰撞，刚开始单纯地以为是生成算法有问题，毕竟就算是4位的短链接也有62^4个链接可能（26个字母的大小写+10个数字），如果生成算法没问题的话发生碰撞的概率应该是较小的。  &lt;/p&gt;
&lt;p&gt;检查了一遍代码，生成算法也确实有一些问题，但都不是主要问题。今天随手在mysql里select了一下，发现查询的时候居然不区分大小写！那么其实4位的短链接就只有36^4个链接可能（160多万而已）！  &lt;/p&gt;
&lt;p&gt;查阅了mysql相关文档，大致了解了mysql字符集及校对规则的选取方式：  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;如果指定了字符集和校对规则，那么采用指定的字符集和校对规则。  &lt;/li&gt;
&lt;li&gt;如果指定了字符集但没有指定校对规则，那么采用指定的字符集和该字符集的默认校对规则。  &lt;/li&gt;
&lt;li&gt;否则，采用服务器字符集和服务器校对规则。  &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;可以通过show collation命令查询支持的校对规则及字符集默认的校对规则。&lt;br&gt;mysql数据库也差不多支撑不住目前的需求了，反正要迁移到分布式数据库了就暂时不理这个问题了。但越来越觉得是应该好好完整地将mysql手册看一遍了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近发现短链接服务在生成短链接时经常会发生碰撞，刚开始单纯地以为是生成算法有问题，毕竟就算是4位的短链接也有62^4个链接可能（26个字母的大小写+10个数字），如果生成算法没问题的话发生碰撞的概率应该是较小的。  &lt;/p&gt;
&lt;p&gt;检查了一遍代码，生成算法也确实有一些问题，
    
    </summary>
    
    
      <category term="mysql" scheme="http://dhf.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>邮件信头中Return-Path、Reply-To和From的区别</title>
    <link href="http://dhf.im/2010/08/01/return-path_reply-to_from/"/>
    <id>http://dhf.im/2010/08/01/return-path_reply-to_from/</id>
    <published>2010-07-31T18:14:27.000Z</published>
    <updated>2016-04-26T14:53:59.000Z</updated>
    
    <content type="html">&lt;p&gt;懒得自己写，直接引用一段别人的回复（&lt;a href=&quot;http://stackoverflow.com/questions/1235534/what-is-the-behavior-difference-between-return-path-reply-to-and-from&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原贴传送门&lt;/a&gt;），大致跟自己之前的实践及查看的文档相符。  &lt;/p&gt;
&lt;pre&gt;
1)The Return-Path (sometimes called the Reverse-Path or Envelope-FROM -- all of these terms can be used interchangeably) is the value used during the SMTP session. As you can see, this does not need to be the same value that is actually found in the mail headers. Only the recipient&#39;s mail server is supposed to add a Return-Path header to the top of the email. This records the actual Return-Path sender during the SMTP session. If a Return-Path header is already exists in the email, then that header is to be removed, and replaced by the recipient&#39;s mail server.

All bounces that occur during the SMTP session should go back to the Return-Path value. Some servers may accept all email, and then queue it locally, until it has a free thread to deliver it to the recipient&#39;s mailbox. If the recipient doesn&#39;t exist, it should bounce it back to the recorded Return-Path value.

Note, not all mail servers obey this rule. Some mail servers will bounce it back to the FROM address.

2)The FROM address is the value actually found in the FROM header. This is supposed to be who the message is FROM. This is what you see as the &quot;FROM&quot; in most mail clients. If an email does not have a Reply-To header, then all human (mail client) replies should go back to the FROM address.

3)The Reply-To header is added by the sender (or the sender&#39;s software). It is where all human replies should be addressed too. Basically, when the user clicks &quot;reply&quot;, the Reply-To value should be the value used as the recpient of the newly composed email. The Reply-To value should not be used by any server. It is meant for client side use.

However, as you can tell, not all mail servers obey the RFC standards or recommendations.
&lt;/pre&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;懒得自己写，直接引用一段别人的回复（&lt;a href=&quot;http://stackoverflow.com/questions/1235534/what-is-the-behavior-difference-between-return-path-reply-to-and-fr
    
    </summary>
    
    
      <category term="from" scheme="http://dhf.im/tags/from/"/>
    
      <category term="reply-to" scheme="http://dhf.im/tags/reply-to/"/>
    
      <category term="return-path" scheme="http://dhf.im/tags/return-path/"/>
    
  </entry>
  
  <entry>
    <title>数据库表的轮转（续）</title>
    <link href="http://dhf.im/2010/08/01/database_table_rotate_2/"/>
    <id>http://dhf.im/2010/08/01/database_table_rotate_2/</id>
    <published>2010-07-31T17:53:55.000Z</published>
    <updated>2016-04-26T14:44:38.000Z</updated>
    
    <content type="html">&lt;p&gt;上次提到了数据库表的轮转，大致阐述了问题及初步的解决方法。然而实现的时候还是会遇到些问题。  &lt;/p&gt;
&lt;p&gt;轮转的时候，需要将旧表A中未完成的任务都迁移到新建的表B中（当然也可以不迁移，而是直接将旧表中的任务处理完为止，但这种方式更为复杂曲折，不予考虑）。迁移的时候有可能会往A中继续插入新的任务，迁移可能会遗漏一些记录；或者从A中取出任务执行完后需要更新任务状态时却发现A中该记录已被迁移到B中了，造成任务状态的不确定性；又或者在A中存在某用户U的开通记录但处理时失败了需要继续重试，但迁移过程中继续插入了一条取消记录，那么就有可能取消成功了但是又由于之前有个失败的开通记录，重试后就导致又被开通了。可能存在的问题还有许多，比如有可能新建表或迁移的时候数据库处理失败了。有没办法将创建新表、迁移记录处理成一个原子操作呢？  &lt;/p&gt;
&lt;p&gt;首先想到的是通过加锁。具体步骤如下：  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;创建新表B  &lt;/li&gt;
&lt;li&gt;对旧表A和新表B及轮转记录表C都加写锁（lock tables a write, b write, c write;）  &lt;/li&gt;
&lt;li&gt;关闭自动提交（set autocommit=0）  &lt;/li&gt;
&lt;li&gt;更新轮转记录C  &lt;/li&gt;
&lt;li&gt;将旧表A中需要迁移的记录都select出来，然后批量插入到B中  &lt;/li&gt;
&lt;li&gt;将sql语句中记录的tableName变量更改成新表B的表名  &lt;/li&gt;
&lt;li&gt;更新轮转记录C，标记本次迁移完成&lt;/li&gt;
&lt;li&gt;释放表锁（unlock tables）及其他一些后续处理  &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;但由于对数据库锁天然的畏惧，最终并没有使用该方式，而是通过自己程序内部控制以模拟达到锁的效果。具体步骤如下：  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;创建新表B  &lt;/li&gt;
&lt;li&gt;设置onCopy=true（onCopy=true时，其他希望更新任务记录的数据库操作都会阻塞在copyLock.wait()上）&lt;br&gt;3~7与上述方式一致  &lt;/li&gt;
&lt;li&gt;设置onCopy=false，并调用copyLock.notifyAll()以唤醒所有阻塞的数据库操作  &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这次重构，由于对mysql的了解还不够深入，花费了许多时间，期间详细查看了&lt;a href=&quot;http://dev.mysql.com/doc/refman/5.1/en/sql-syntax-transactions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;mysql官方文档&lt;/a&gt;关于事务及锁的描述，获益匪浅&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;上次提到了数据库表的轮转，大致阐述了问题及初步的解决方法。然而实现的时候还是会遇到些问题。  &lt;/p&gt;
&lt;p&gt;轮转的时候，需要将旧表A中未完成的任务都迁移到新建的表B中（当然也可以不迁移，而是直接将旧表中的任务处理完为止，但这种方式更为复杂曲折，不予考虑）。迁移的时候有可能
    
    </summary>
    
    
      <category term="mysql" scheme="http://dhf.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>数据库表的轮转</title>
    <link href="http://dhf.im/2010/07/24/database_table_rotate_1/"/>
    <id>http://dhf.im/2010/07/24/database_table_rotate_1/</id>
    <published>2010-07-23T18:47:00.000Z</published>
    <updated>2016-04-26T14:44:11.000Z</updated>
    
    <content type="html">&lt;p&gt;负责的一个项目，在开通时会赠送一批服务（粗略算了下大概有10来个），而开通这些服务有些可能比较耗时，就将这些服务都以后台任务的形式处理了。  &lt;/p&gt;
&lt;p&gt;最开始开通量少的时候，这些任务都是在一张表里以不同任务名记录的，处理完就修改下任务状态。后来随着开通量的增加，集中在一张表里已经开始会影响性能了，那么很自然地就想到分表，将不同的任务划分到不同的表里，数据量就少了一个数量级。  &lt;/p&gt;
&lt;p&gt;但是开通量增长得比较快，就算分表发现性能也并不能好多少。最开始想偷懒就打算隔一段时间清理一下已经处理完的任务（反正这些任务处理完后基本都不需要再保留的了），但是mysql如果不optimize表的话，删除的空间是不会被回收利用的，索引也是，所以就得经常停机optimize表。  &lt;/p&gt;
&lt;p&gt;经常这么折腾，谁都受不了，而且服务也得停会影响线上用户的正常使用也不好。最近就将这些任务表都做成按天轮转，每天轮换一个表，这样每个表的数据就基本在10多万行里，而且空间不够的时候可以直接drop掉一些过期的表（写个脚本定期drop）也不会影响线上服务，维护工作量明显少了很多。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;负责的一个项目，在开通时会赠送一批服务（粗略算了下大概有10来个），而开通这些服务有些可能比较耗时，就将这些服务都以后台任务的形式处理了。  &lt;/p&gt;
&lt;p&gt;最开始开通量少的时候，这些任务都是在一张表里以不同任务名记录的，处理完就修改下任务状态。后来随着开通量的增加，集中在
    
    </summary>
    
    
      <category term="mysql" scheme="http://dhf.im/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>转换文件名编码</title>
    <link href="http://dhf.im/2010/07/16/convert_filename_encoding/"/>
    <id>http://dhf.im/2010/07/16/convert_filename_encoding/</id>
    <published>2010-07-16T14:46:40.000Z</published>
    <updated>2016-04-26T14:43:42.000Z</updated>
    
    <content type="html">&lt;p&gt;合作方给了一批含有大量中文文件名的文件过来，需要对这批文件批量处理后再将结果反馈回去。这批文件的文件名是GBK编码的，但是我本地的环境是zh_CN.UTF-8的，在我的机器上这些文件名就乱码了。当然，可以先通过LANG=zh_CN.GBK将本地环境临时改成GBK来处理，但是能不能一次性将这些文件名批量转成UTF-8呢？  &lt;/p&gt;
&lt;p&gt;很显然，是可以的。iconv能将文件内容从一种字符集编码转换成另一种，类似的，convmv能将文件名从一种编码转换成另一种。&lt;/p&gt;
&lt;p&gt;&lt;pre&gt;&lt;br&gt;conmv - converts filenames from one encoding to another.&lt;br&gt;&lt;/pre&gt;&lt;br&gt;这个命令相当强大，可以递归目录，可以指定其他命令替代rename操作，可以指定低内存使用量，可以unescape，可以转换大小写等。实乃居家旅行，杀人灭口必备良品啊！&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;合作方给了一批含有大量中文文件名的文件过来，需要对这批文件批量处理后再将结果反馈回去。这批文件的文件名是GBK编码的，但是我本地的环境是zh_CN.UTF-8的，在我的机器上这些文件名就乱码了。当然，可以先通过LANG=zh_CN.GBK将本地环境临时改成GBK来处理，但是
    
    </summary>
    
    
      <category term="iconv" scheme="http://dhf.im/tags/iconv/"/>
    
      <category term="convmv" scheme="http://dhf.im/tags/convmv/"/>
    
  </entry>
  
  <entry>
    <title>[转]字符集和编码的经典</title>
    <link href="http://dhf.im/2010/04/18/character_encoding_classic/"/>
    <id>http://dhf.im/2010/04/18/character_encoding_classic/</id>
    <published>2010-04-18T08:20:53.000Z</published>
    <updated>2016-04-26T14:42:43.000Z</updated>
    
    <content type="html">&lt;p&gt;【转】出处不详&lt;/p&gt;
&lt;pre&gt;
很久很久以前，有一群人，他们决定用8个可以开合的晶体管来组合成不同的状态，以表示世界上的万物。他们看到8个开关状态是好的，于是他们把这称为&quot;字节&quot;。

再后来，他们又做了一些可以处理这些字节的机器，机器开动了，可以用字节来组合出很多状态，状态开始变来变去。他们看到这样是好的，于是它们就这机器称为&quot;计算机&quot;。

开始计算机只在美国用八位的字节一共可以组合出256(2的8次方)种不同的状态。

他们把其中的编号从0开始的32种状态分别规定了特殊的用途，一但终端、打印机遇上约定好的这些字节被传过来时，就 要做一些约定的动作。遇上00x10,终端就换行，遇上0x07,终端就向人们嘟嘟叫，例好遇上0x1b,打印机就打印反白的字，或者终端就用彩色显示字母。他们看到这样很好，于是就把这些0x20以下的字节状态称为&quot;控制码&quot;。

他们又把所有的空格、标点符号、数字、大小写字母 分别用连续的字节状态表示，一直编到了第127号，这样计算机就可以用不同字节来存储英语的文字了。大家看到这样，都感觉很好，于是大家都把这个方案叫做ANSI的&quot;Ascii&quot;编码（American Standard Code for Information Interchange，美国信息互换标准代码）。当时世界上所有的计算机都用同样的ASCII方案来保存英文文字。

后来，就像建造巴比伦塔一样，世界各地的都开始使用计算机，但是很多国家用的不是英文，他们的字母里有许多是ASCII里没有的，为了可以在计算机保存他们的文字，他们决定采用127号之后的空位来表示这些新的字母、符号，还加入了很多画表格时需要用下到的横线、竖线、交叉等形状，一直把序号编到了最后一个状态255。从128到255这一页的字符集被称&quot;扩展字符集&quot;。从此之后，贪婪的人类再没有新的状态可以用了，美帝国主义可能没有想到还有第三世界国家的人们也希望可以用到计算机吧！  

等中国人们得到计算机时，已经没有可以利用的字节状态来表示汉字，况且有6000多个常用汉字需要保存呢。但是这难不倒智慧的中国人民，我们不客气地把那些127号之后的奇异符号们直接取消掉, 规定：一个小于127的字符的意义与原来相同，但两个大于127的字符连在一起时，就表示一个汉字，前面的一个字节（他称之为高字节）从0xA1用到0xF7，后面一个字节（低字节）从0xA1到0xFE，这样我们就可以组合出大约7000多个简体汉字了。在这些编码里，我们还把数学符号、罗马希腊的字母、日文的假名们都编进去了，连在ASCII里本来就有的数字、标点、字母都统统重新编了两个字节长的编码，这就是常说的&quot;全角&quot;字符，而原来在127号以下的那些就叫&quot;半角&quot;字符了。  

中国人民看到这样很不错，于是就把这种汉字方案叫做 &quot;GB2312&quot;。GB2312是对ASCII的中文扩展。

但是中国的汉字太多了，我们很快就就发现有许多人的人名没有办法在这里打出来，特别是某些很会麻烦别人的国家领导人。于是我们不得不继续把GB2312没有用到的码位找出来老实不客气地用上。

后来还是不够用，于是干脆不再要求低字节一定是127号之后的内码，只要第一个字节是大于127就固定表示这是一个汉字的开始，不管后面跟的是不是扩展字符 集里的内容。结果扩展之后的编码方案被称为GBK标准，GBK包括了GB2312的所有内容，同时又增加了近20000个新的汉字（包括繁体字）和符号。  

后来少数民族也要用电脑了，于是我们再扩展，又加了几千个新的少数民族的字，GBK扩成了GB18030。从此之后，中华民族的文化就可以在计算机时代中传承了。

中国的程序员们看到这一系列汉字编码的标准是好的，于是通称他们叫做&quot;DBCS&quot;（Double Byte Charecter Set 双字节字符集）。在DBCS系列标准里，最大的特点是两字节长的汉字字符和一字节长的英文字符并存于同一套编码方案里，因此他们写的程序为了支持中文处理，必须要注意字串里的每一个字节的值，如果这个值是大于127的，那么就认为一个双字节字符集里的字符出现了。那时候凡是受过加持，会编程的计算机僧侣们都要每天念下面这个咒语数百遍：  

&quot;一个汉字算两个英文字符！一个汉字算两个英文字符......&quot;

因为当时各个国家都像中国这样搞出一套自己的编码标准，结果互相之间谁也不懂谁的编码，谁也不支持别人的编码，连大陆和台湾这样只相隔了150海里，使用着同一种语言的兄弟地区，也分别采用了不同的 DBCS 编码方案。当时的中国人想让电脑显示 汉字，就必须装上一个&quot;汉字系统&quot;，专门用来处理汉字的显示、输入的问题，但是那个台湾的愚昧封建人士写的算命程序就必须加装另一套支持BIG5编码的什么&quot;倚天汉字系统&quot;才可以用，装错了字符系统，显示就会乱了套！这怎么办？而且世界民族之林中还有那些一时用不上电脑的穷苦人民，他们的文字又怎么办？

真是计算机的巴比伦塔命题啊！

正在这时，大天使加百列及时出现了：一个叫ISO（国际标谁化组织）的国际组织决定着手解决这个问题。他们采用的方法很简单：废了所有的地区性编码方案，重新搞一个包括了地球上所有文化、所有字母和符号的编码！他们打算叫它&quot;Universal Multiple-Octet Coded Character Set&quot;，简称 UCS, 俗称 &quot;UNICODE&quot;。

UNICODE开始制订时，计算机的存储器容量极大地发展了，空间再也不成为问题了。于是ISO就直接规定必须用两个字节，也就是16位来统一表示所有的字符，对于ascii里的那些&quot;半角&quot;字符，UNICODE包持其原编码不变，只是将其长度由原来的8位扩展为16位，而其他文化和语言的字符则全部重新统一编 码。由于&quot;半角&quot;英文符号只需要用到低8位，所以其高8位永远是0，因此这种大气的方案在保存英文文本时会多浪费一倍的空间。  

这时候，从旧社会里走过来的程序员开始发现一个奇怪的现象：他们的strlen函数靠不住了，一个汉字不再是相当于两个字符了，而是一个！是的， 从UNICODE 开始，无论是半角的英文字母，还是全角的汉字，它们都是统一的&quot;一个字符&quot;！同时，也都是统一的&quot;两个字节&quot;，请注意&quot;字符&quot;和&quot;字节&quot;两个术语的不同，&quot;字节&quot;是一个8位的物理存贮单元，而&quot;字符&quot;则是一个文化相关的符号。在UNICODE中，一个字符就是两个字节。一个汉字算两个英文字符的时代已经快过去了。

从前多种字符集存在时，那些做多语言软件的公司遇上过很大麻烦，他们为了在不同的国家销售同一套软件，就不得不在区域化软件时也加持那个双字节字符集咒语，不仅要处处小心不要搞错，还要把软件中的文字在不同的字符集中转来转去。UNICODE 对于他们来说是一个很好的一揽子解决方案，于是从Windows NT开始，MS趁机把它们的操作系统改了一遍，把所有的核心代码都改成了用UNICODE方式工作的版本，从这时开始，WINDOWS系统终于无需要加装各种本土语言系统，就可以显示全世界上所有文化的字符了。  

但是，UNICODE在制订时没有考虑与任何一种现有的编码方案保持兼容，这使得GBK与UNICODE在汉字的内码编排上完全是不一样的，没有一种简单的算术方法可以把文本内容从UNICODE编码和另一种编码进行转换，这种转换必须通过查表来进行。

如前所述，UNICODE是用两个字节来表示为一个字符，他总共可以组合出65535不同的字符，这大概已经可以覆盖世界上所有文化的符号。如果还不够也没有关系，ISO已经准备了UCS-4方案，说简单了就是四个字节来表示一个字符，这样我们就可以组合出21亿个不同的字符出来（最高位有其他用途），这大概可以用到银河联邦成立那一天吧！  

UNICODE来到时，一起到来的还有计算机网络的兴起，UNICODE如何在网络上传输也是一个必须考虑的问题，于是面向传输的众多UTF（UCS Transfer Format）标准出现了，顾名思义，UTF8就是每次8个位传输数据，而UTF16就是每次16个位，只不过为了传输时的可靠性，从UNICODE到UTF时并不是直接的对应，而是要过一些算法和规则来转换。

受到过网络编程加持的计算机僧侣们都知道，在网络里传递信息时有一个很重要的问题，就是对于数据高低位的解读方式，一些计算机是采用低位先发送的方法，例如我们PC机采用的INTEL架构，而另一些是采用高位先发送的方式，在网络中交换数据时，为了核对双方对于高低位的认识是否是一致的，采用了一种很简便的方法，就是在文本流的开始时向对方发送一个标志符。如果之后的文本是高位在位，那就发送&quot;FEFF&quot;，反之，则发送&quot;FFFE&quot;。不信你可以用二进制 方式打开一个UTF-X格式的文件，看看开头两个字节是不是这两个字节？  

讲到这里，我们再顺便说说一个很著名的奇怪 现象：当你在 windows 的记事本里新建一个文件，输入&quot;联通&quot;两个字之后，保存，关闭，然后再次打开，你会发现这两个字已经消失了，代之的是几个 乱码！呵呵，有人说这就是联通之所以拼不过移动的原因。

其实这是因为GB2312编码与UTF8编码产生了编码冲撞的原因。

从网上引来一段从UNICODE到UTF8的转换规则：

Unicode

UTF-8  
0000 - 007F

0xxxxxxx

0080 - 07FF

110xxxxx 10xxxxxx

0800 - FFFF

1110xxxx 10xxxxxx 10xxxxxx

例如&quot;汉&quot;字的Unicode编码是 6C49。6C49在0800-FFFF之间，所以要用3字节模板：1110xxxx 10xxxxxx 10xxxxxx。将6C49写成二进制 是：0110 1100 0100 1001，将这个比特流按三字节模板的分段方法分为0110 110001 001001，依次代替模板中的x，得 到：1110-0110 10-110001 10-001001，即E6 B1 89，这就是其UTF8的编码。  

而当你新建一个文本文件时，记事本的编码默认是ANSI, 如果你在ANSI的编码输入汉字，那么他实际就是GB系列的编码方式，在这种编码下，&quot;联通&quot;的内码是：

c1 1100 0001

aa 1010 1010

cd 1100 1101

a8 1010 1000

注意到了吗？第一二个字节、第三四个字节的起始部分的都是&quot;110&quot;和&quot;10&quot;，正好与UTF8规则里的两字节模板是一致的，于是再次打开记事本时，记事本 就误认为这是一个UTF8编码的文件，让我们把第一个字节的110和第二个字节的10去掉，我们就得到了&quot;00001 101010&quot;，再把各位对齐，补上前导的0，就得到了&quot;0000 0000 0110 1010&quot;，不好意思，这是UNICODE的006A，也就是小写的字母&quot;j&quot;，而之后的两字节用UTF8解码之后是0368，这个字符什么也不是。这就是只有&quot;联通&quot;两个字的文件没有办法在记事本里正常显示的原因。  

而如果你在&quot; 联通&quot;之后多输入几个字，其他的字的编码不见得又恰好是110和10开始的字节，这样再次打开时，记事本就不会坚持这是一个utf8编码的文件，而会用ANSI的方式解读之，这时乱码又不出现了。
&lt;/pre&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;【转】出处不详&lt;/p&gt;
&lt;pre&gt;
很久很久以前，有一群人，他们决定用8个可以开合的晶体管来组合成不同的状态，以表示世界上的万物。他们看到8个开关状态是好的，于是他们把这称为&quot;字节&quot;。

再后来，他们又做了一些可以处理这些字节的机器，机器开动了，可以用字节来组合出很多状态，
    
    </summary>
    
    
      <category term="charset" scheme="http://dhf.im/tags/charset/"/>
    
      <category term="encoding" scheme="http://dhf.im/tags/encoding/"/>
    
  </entry>
  
  <entry>
    <title>nohup</title>
    <link href="http://dhf.im/2010/02/10/nohup/"/>
    <id>http://dhf.im/2010/02/10/nohup/</id>
    <published>2010-02-09T18:50:59.000Z</published>
    <updated>2016-04-26T14:52:43.000Z</updated>
    
    <content type="html">&lt;p&gt;Linux的常识知道得太少了，需要不断累积一下。  &lt;/p&gt;
&lt;p&gt;最近有一些批量任务需要花费较多的时间来运行，但总不可能开着终端一种挂着吧？之前知道在命令后面再加个 &lt;code&gt;&amp;amp;&lt;/code&gt; 就可以让任务在后台执行，本以为这样就OK万事大吉了，谁知道关掉终端后重新打开，发现任务居然中止了！  &lt;/p&gt;
&lt;p&gt;OMG，原来通过 &lt;code&gt;&amp;amp;&lt;/code&gt; 并不能解决问题！断开终端后，通过 &lt;code&gt;&amp;amp;&lt;/code&gt; 在后台运行的进程也会跟着中止，这时候就需要使用nohup(no hang up)这个命令了，通过nohup命令，可以让任务一直在后台运行，就算断开终端，任务仍然会继续执行。  &lt;/p&gt;
&lt;p&gt;又长见识了，哎，继续找出没有做完的任务重新跑吧，悲剧啊！&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;Linux的常识知道得太少了，需要不断累积一下。  &lt;/p&gt;
&lt;p&gt;最近有一些批量任务需要花费较多的时间来运行，但总不可能开着终端一种挂着吧？之前知道在命令后面再加个 &lt;code&gt;&amp;amp;&lt;/code&gt; 就可以让任务在后台执行，本以为这样就OK万事大吉了，谁知道关掉终端后
    
    </summary>
    
    
      <category term="Linux" scheme="http://dhf.im/tags/Linux/"/>
    
      <category term="nohup" scheme="http://dhf.im/tags/nohup/"/>
    
  </entry>
  
  <entry>
    <title>Content-Type 引发的血案</title>
    <link href="http://dhf.im/2010/01/05/content-type_disaster/"/>
    <id>http://dhf.im/2010/01/05/content-type_disaster/</id>
    <published>2010-01-04T16:57:29.000Z</published>
    <updated>2016-04-26T14:42:38.000Z</updated>
    
    <content type="html">&lt;p&gt;最近一个页面用到了my97datepicker日期控件，奇怪的是IE下控件很正常，但是在FF下控件死活出不来，点击没有任何反应，抓破头皮也想不出个所以然来。一时心血来潮想看看是不是JS有写错，打开FF的错误控制台调试了下，结果发现这么个错误：  &lt;/p&gt;
&lt;pre&gt;
错误： 样式表单 xxx&amp;nbsp;未载入，因为它的MIME类型 &quot;text/html&quot; 不是 &quot;text/css&quot;
&lt;/pre&gt;

&lt;p&gt;奇怪啊，文件名明明是.css结尾的，怎么MIME类型是text/html呢？看了下服务器resin和apache的配置，MIME类型的映射关系配置项居然大部分给注释了！OMG！难怪MIME类型不对了！把映射关系加回去后果然在FF下一切正常了。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近一个页面用到了my97datepicker日期控件，奇怪的是IE下控件很正常，但是在FF下控件死活出不来，点击没有任何反应，抓破头皮也想不出个所以然来。一时心血来潮想看看是不是JS有写错，打开FF的错误控制台调试了下，结果发现这么个错误：  &lt;/p&gt;
&lt;pre&gt;
错误：
    
    </summary>
    
    
      <category term="content-type" scheme="http://dhf.im/tags/content-type/"/>
    
      <category term="css" scheme="http://dhf.im/tags/css/"/>
    
      <category term="my97datepicker" scheme="http://dhf.im/tags/my97datepicker/"/>
    
  </entry>
  
  <entry>
    <title>谨防IE缓存请求</title>
    <link href="http://dhf.im/2010/01/04/ie-ajax-cache/"/>
    <id>http://dhf.im/2010/01/04/ie-ajax-cache/</id>
    <published>2010-01-04T13:39:20.000Z</published>
    <updated>2016-04-26T14:46:05.000Z</updated>
    
    <content type="html">&lt;p&gt;最近写一块通过ajax请求验证码的代码时发现，在FF和Chrome下都可以正常更换验证码，但在IE下获取了一次验证码之后就无法再刷新验证码了。&lt;br&gt;后来抓包发现，IE获取了一次验证码后就没有再发请求到服务端了，之后的请求都通过缓存直接返回了。&lt;br&gt;缓存静态资源倒还说得过去，缓存.jsp、.do等也太恶心了点，不知道IE是否可以设置缓存策略。不过写这些代码的时候最好注意一下，在这些请求后面都带上一个随机数就OK了，这样确保每次请求都会发到服务端。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近写一块通过ajax请求验证码的代码时发现，在FF和Chrome下都可以正常更换验证码，但在IE下获取了一次验证码之后就无法再刷新验证码了。&lt;br&gt;后来抓包发现，IE获取了一次验证码后就没有再发请求到服务端了，之后的请求都通过缓存直接返回了。&lt;br&gt;缓存静态资源倒还说得过
    
    </summary>
    
    
      <category term="ajax" scheme="http://dhf.im/tags/ajax/"/>
    
      <category term="ie" scheme="http://dhf.im/tags/ie/"/>
    
      <category term="cache" scheme="http://dhf.im/tags/cache/"/>
    
  </entry>
  
  <entry>
    <title>Javamail处理一些未知的编码</title>
    <link href="http://dhf.im/2010/01/03/javamail_unknown_character_encoding/"/>
    <id>http://dhf.im/2010/01/03/javamail_unknown_character_encoding/</id>
    <published>2010-01-03T10:49:15.000Z</published>
    <updated>2016-04-26T14:49:22.000Z</updated>
    
    <content type="html">&lt;p&gt;查看邮件信头的时候有时会看到x-gbk、hz-gb-2312等编码，然而这些编码javamail并不能识别出来。但是看名称感觉又似曾相识，尝试把x-gbk的编码改成gbk、hz-gb-2312改成gb2312后javamail又能解码出来。虽然并不知道x-gbk、hz-gb-2312是否和gbk、gb2312的标准有什么不同，或者仅仅只是这些编码的别名而已，但是的确可以通过把x-gbk映射成gbk来解决一些编码问题。那么一种便捷的做法便是通过往javamail的javamail.charset.map文件里添加x-gbk到gbk的映射关系，这样就可以对x-gbk进行解码了。&lt;/p&gt;
&lt;p&gt;PS：通过findbugs发现，javax.mail.internet.MimeUtility里居然有一行代码是通过==来判断字符串是否相同。囧rz&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;查看邮件信头的时候有时会看到x-gbk、hz-gb-2312等编码，然而这些编码javamail并不能识别出来。但是看名称感觉又似曾相识，尝试把x-gbk的编码改成gbk、hz-gb-2312改成gb2312后javamail又能解码出来。虽然并不知道x-gbk、hz-gb
    
    </summary>
    
    
      <category term="javamail" scheme="http://dhf.im/tags/javamail/"/>
    
      <category term="x-gbk" scheme="http://dhf.im/tags/x-gbk/"/>
    
  </entry>
  
  <entry>
    <title>Java添加UTF-7字符集支持</title>
    <link href="http://dhf.im/2010/01/03/java_utf7/"/>
    <id>http://dhf.im/2010/01/03/java_utf7/</id>
    <published>2010-01-03T09:47:27.000Z</published>
    <updated>2016-04-26T14:48:46.000Z</updated>
    
    <content type="html">&lt;p&gt;这段时间在做PushServer时，需要对编码过的邮件标题及发信人进行解码，然而开发的时候发现Javamail无法对UTF-7等编码解码，会抛出UnsupportedEncodingException。查看过JDK中rt.jar的部分代码，也看过javamail的部分代码，总结原因如下：JDK本身并不支持UTF-7字符集。关于这个bug（&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4304013&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;传送门&lt;/a&gt;），很早之前就有人反馈过给SUN了，但SUN已经明确表示不会修复这个bug，所以要想支持UTF-7字符集就必须自己写对应的Charset。  &lt;/p&gt;
&lt;p&gt;当然，秉承不重复发明轮子的精神，如果有人已经提供了这样的类的话我们就没必要再自己重新实现了。确实已经有人做了这样的事，jcharset（&lt;a href=&quot;http://www.freeutils.net/source/jcharset/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;传送门&lt;/a&gt;）这个项目已经提供了UTF-7、UTF-7-OPTIONAL等字符集的实现方式，只需要下载jcharset.jar并将其放到${JAVA_HOME}/jre/lib/ext/下即可（这是SUN JRE的一个&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4619777&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;bug&lt;/a&gt;），这样就已经可以对UTF-7编码的字符串进行解码了。需要注意的是jcharset项目是在GPL许可下发布的，若只是需要添加UTF-7字符集的支持的话，可以考虑jutf7项目（&lt;a href=&quot;http://jutf7.sourceforge.net/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;传送门&lt;/a&gt;），这个项目是在MIT许可下发布的，这样做2次开发之类的都方便。若需要自己添加其他字符集的支持，可以参考jcharset、jutf7等项目。  &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;这段时间在做PushServer时，需要对编码过的邮件标题及发信人进行解码，然而开发的时候发现Javamail无法对UTF-7等编码解码，会抛出UnsupportedEncodingException。查看过JDK中rt.jar的部分代码，也看过javamail的部分代码，
    
    </summary>
    
    
      <category term="java" scheme="http://dhf.im/tags/java/"/>
    
      <category term="utf7" scheme="http://dhf.im/tags/utf7/"/>
    
  </entry>
  
</feed>
